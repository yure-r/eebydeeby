{"ast":null,"code":"import _toConsumableArray from \"/Users/richardyurewitch/Downloads/emojibuilder-master 3/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/richardyurewitch/Downloads/emojibuilder-master 3/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/richardyurewitch/Downloads/emojibuilder-master 3/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/richardyurewitch/Downloads/emojibuilder-master 3/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/richardyurewitch/Downloads/emojibuilder-master 3/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/richardyurewitch/Downloads/emojibuilder-master 3/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/richardyurewitch/Downloads/emojibuilder-master 3/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport './Panel.css';\nimport Loading from './Loading.js';\nimport Library from './Library.js';\nimport Layers from './Layers.js';\nimport Canvas from './Canvas.js';\nimport Title from './Title.js';\nimport Button from './Button.js';\nimport Import from './Import.js';\nimport config from './config.js';\nimport assets from './assets.js';\nimport { toTitleCase } from './utils.js';\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(App)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      assets: assets,\n      assetsLoaded: 0,\n      allAssetsLoaded: false,\n      layers: [],\n      title: ''\n    };\n    _this.config = config;\n    _this.Library = React.createRef();\n    _this.Layers = React.createRef();\n    _this.Canvas = React.createRef();\n    _this.Title = React.createRef();\n    _this.SaveButton = React.createRef();\n\n    _this.findAsset = function (name) {\n      return _this.state.assets.find(function (asset) {\n        return asset.name === name;\n      });\n    };\n\n    _this.addCustomAsset = function (name, src) {\n      name = name.substr(0, name.lastIndexOf('.')).replace(/_|-/g, ' ');\n      var prettyName = toTitleCase(name);\n      var imgEl = React.createElement(\"img\", {\n        src: src,\n        alt: prettyName,\n        className: \"asset\",\n        draggable: false,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      });\n      var img = document.createElement('img');\n      var asset = {\n        name: name,\n        prettyName: prettyName,\n        category: 'custom',\n        prettyCategory: 'Custom',\n        src: src,\n        imgEl: imgEl,\n        img: img\n      };\n\n      img.onload = function (e) {\n        var assets = _toConsumableArray(_this.state.assets);\n\n        assets.unshift(asset);\n\n        _this.setState({\n          assets: assets\n        }, function () {\n          _this.addLayer(asset.name);\n        });\n      };\n\n      img.src = src;\n    };\n\n    _this.randomize = function () {\n      function pick(category) {\n        var picks = assets.filter(function (asset) {\n          return asset.category === category;\n        });\n        return picks[Math.floor(Math.random() * picks.length)].name;\n      }\n\n      _this.clear().then(function () {\n        _this.addLayer(pick('mouth'));\n\n        var eye = pick('eye');\n\n        _this.addLayer(eye);\n\n        if (Math.random() > 0.5) _this.addLayer(eye);else _this.addLayer(pick('eye'));\n        if (Math.random() > 0.5) _this.addLayer(pick('acc'), Math.random() > 0.5);\n      });\n    };\n\n    _this.clear = function (callback) {\n      var base = _this.findBaseLayer();\n\n      var baseAssetName = base ? base.asset.name : 'face_base';\n      return new Promise(function (resolve, reject) {\n        _this.setState({\n          layers: []\n        }, function () {\n          if (baseAssetName) _this.addLayer(baseAssetName);\n          resolve();\n        });\n      });\n    };\n\n    _this.save = function () {\n      var canvas = _this.Canvas.current.mainCanvas.current;\n\n      var title = _this.Title.current.getTitle();\n\n      var button = _this.SaveButton.current;\n      button.href = canvas.toDataURL();\n      button.download = title.replace(/ /g, '_') + '.png';\n\n      if (window.gtag) {\n        window.gtag('event', 'download', {\n          event_category: 'emojibuilder',\n          event_label: title\n        });\n      }\n    };\n\n    _this.addLayer = function (assetName, flipped) {\n      var layers = _toConsumableArray(_this.state.layers);\n\n      var layer = {\n        asset: _this.findAsset(assetName),\n        flipped: flipped,\n        transform: {\n          translateX: 0,\n          translateY: 0,\n          scale: 1,\n          rotate: 0\n        },\n        showTransforms: false\n      }; // Flip any second 'eye' layers or duplicates\n\n      if (flipped === undefined) {\n        var eyes = layers.filter(function (layer) {\n          return layer.asset.category === 'eye';\n        });\n        var dups = layers.filter(function (layer) {\n          return layer.asset.name === assetName;\n        });\n        layer.flipped = eyes.length === 1 && !eyes[0].flipped || dups.length === 1 && !dups[0].flipped;\n      } // Only allow one 'base' layer\n\n\n      if (layer.asset.base) {\n        layers = layers.filter(function (layer) {\n          return !layer.asset.base;\n        });\n      } // Add layer at a specific position\n\n\n      if (layer.asset.position !== undefined && layers.length > 0) {\n        var insertIndex = Math.min(layer.asset.position, layers.length - 1);\n        layers.splice(insertIndex, 0, layer);\n      } // Or just at the end\n      else {\n          layers.push(layer);\n        }\n\n      _this.setState({\n        layers: layers\n      });\n    };\n\n    _this.removeLayer = function (layer) {\n      var layers = _toConsumableArray(_this.state.layers);\n\n      var index = layers.indexOf(layer);\n      layers.splice(index, 1);\n\n      _this.setState({\n        layers: layers\n      });\n    };\n\n    _this.flipLayer = function (layer) {\n      var layers = _toConsumableArray(_this.state.layers);\n\n      var index = layers.indexOf(layer);\n      layers[index].flipped = !layers[index].flipped;\n\n      _this.setState({\n        layers: layers\n      });\n    };\n\n    _this.toggleLayerTransforms = function (layer) {\n      var layers = _toConsumableArray(_this.state.layers);\n\n      var index = layers.indexOf(layer);\n      layers[index].showTransforms = !layers[index].showTransforms;\n\n      _this.setState({\n        layers: layers\n      });\n    };\n\n    _this.findBaseLayer = function () {\n      return _this.state.layers.find(function (layer) {\n        return layer.asset.base;\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 36\n        },\n        __self: this\n      }, this.state.allAssetsLoaded ? React.createElement(React.Fragment, null, React.createElement(\"header\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 39\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 40\n        },\n        __self: this\n      }, \"Emojibuilder v1.2\"), React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 41\n        },\n        __self: this\n      }, \"Built by \", React.createElement(\"a\", {\n        href: \"https://twitter.com/phlntn\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 41\n        },\n        __self: this\n      }, \"@phlntn\")), React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 42\n        },\n        __self: this\n      }, \"Assets \\xA9 Apple pls don't sue me\")), React.createElement(\"main\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 45\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"Panel\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 47\n        },\n        __self: this\n      }, React.createElement(Library, {\n        ref: this.Library,\n        app: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 48\n        },\n        __self: this\n      }), React.createElement(\"footer\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 49\n        },\n        __self: this\n      }, React.createElement(Import, {\n        app: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 50\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"Panel preview\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 54\n        },\n        __self: this\n      }, React.createElement(Canvas, {\n        ref: this.Canvas,\n        app: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 55\n        },\n        __self: this\n      }), React.createElement(Title, {\n        ref: this.Title,\n        app: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 56\n        },\n        __self: this\n      }), React.createElement(\"footer\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 57\n        },\n        __self: this\n      }, React.createElement(Button, {\n        label: \"Save\",\n        onClick: this.save,\n        _ref: this.SaveButton,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 58\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"Panel\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 62\n        },\n        __self: this\n      }, React.createElement(Layers, {\n        ref: this.Layers,\n        app: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 63\n        },\n        __self: this\n      }), React.createElement(\"footer\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 64\n        },\n        __self: this\n      }, React.createElement(Button, {\n        label: \"Randomize\",\n        onClick: this.randomize,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 65\n        },\n        __self: this\n      }), React.createElement(Button, {\n        label: \"Clear\",\n        onClick: this.clear,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 66\n        },\n        __self: this\n      }))))) : React.createElement(Loading, {\n        app: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73\n        },\n        __self: this\n      }));\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var assets = _toConsumableArray(this.state.assets);\n\n      return Promise.all(assets.map(function (asset) {\n        return new Promise(function (resolve, reject) {\n          var url = \"\".concat(config.assetBasePath, \"/\").concat(asset.name, \".png?v4\");\n          var options = {\n            method: 'GET',\n            mode: 'cors',\n            cache: 'force-cache'\n          };\n          fetch(url, options).then(function (response) {\n            return response.blob();\n          }).then(function (blob) {\n            asset.src = URL.createObjectURL(blob);\n            asset.imgEl = React.createElement(\"img\", {\n              src: asset.src,\n              alt: asset.prettyName,\n              className: \"asset\",\n              draggable: false,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 98\n              },\n              __self: this\n            });\n            asset.img = document.createElement('img');\n\n            asset.img.onload = function (e) {\n              _this2.setState({\n                assetsLoaded: _this2.state.assetsLoaded + 1\n              });\n\n              resolve();\n            };\n\n            asset.img.src = asset.src;\n          }).catch(function (err) {\n            console.error(\"\".concat(url, \" failed to load\"), err);\n            reject();\n          });\n        });\n      })).then(function () {\n        _this2.setState({\n          assets: assets,\n          allAssetsLoaded: true\n        });\n\n        _this2.randomize();\n      });\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/richardyurewitch/Downloads/emojibuilder-master 3/src/App.js"],"names":["React","Component","Loading","Library","Layers","Canvas","Title","Button","Import","config","assets","toTitleCase","App","state","assetsLoaded","allAssetsLoaded","layers","title","createRef","SaveButton","findAsset","name","find","asset","addCustomAsset","src","substr","lastIndexOf","replace","prettyName","imgEl","img","document","createElement","category","prettyCategory","onload","e","unshift","setState","addLayer","randomize","pick","picks","filter","Math","floor","random","length","clear","then","eye","callback","base","findBaseLayer","baseAssetName","Promise","resolve","reject","save","canvas","current","mainCanvas","getTitle","button","href","toDataURL","download","window","gtag","event_category","event_label","assetName","flipped","layer","transform","translateX","translateY","scale","rotate","showTransforms","undefined","eyes","dups","position","insertIndex","min","splice","push","removeLayer","index","indexOf","flipLayer","toggleLayerTransforms","all","map","url","assetBasePath","options","method","mode","cache","fetch","response","blob","URL","createObjectURL","catch","err","console","error"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport './Panel.css';\n\nimport Loading from './Loading.js';\nimport Library from './Library.js';\nimport Layers from './Layers.js';\nimport Canvas from './Canvas.js';\nimport Title from './Title.js';\nimport Button from './Button.js';\nimport Import from './Import.js';\n\nimport config from './config.js';\nimport assets from './assets.js';\nimport { toTitleCase } from './utils.js';\n\nclass App extends Component {\n  state = {\n    assets,\n    assetsLoaded: 0,\n    allAssetsLoaded: false,\n    layers: [],\n    title: '',\n  };\n\n  config = config;\n\n  Library = React.createRef();\n  Layers = React.createRef();\n  Canvas = React.createRef();\n  Title = React.createRef();\n  SaveButton = React.createRef();\n\n  render() {\n    return (\n      <div className='App'>\n        { this.state.allAssetsLoaded ? (<>\n\n          <header>\n            <span>Emojibuilder v1.2</span>\n            <span>Built by <a href='https://twitter.com/phlntn'>@phlntn</a></span>\n            <span>Assets © Apple pls don't sue me</span>\n          </header>\n\n          <main>\n\n            <div className='Panel'>\n              <Library ref={this.Library} app={this} />\n              <footer>\n                <Import app={this} />\n              </footer>\n            </div>\n\n            <div className='Panel preview'>\n              <Canvas ref={this.Canvas} app={this} />\n              <Title ref={this.Title} app={this} />\n              <footer>\n                <Button label='Save' onClick={this.save} _ref={this.SaveButton} />\n              </footer>\n            </div>\n\n            <div className='Panel'>\n              <Layers ref={this.Layers} app={this} />\n              <footer>\n                <Button label='Randomize' onClick={this.randomize} />\n                <Button label='Clear' onClick={this.clear} />\n              </footer>\n            </div>\n\n          </main>\n\n        </>) : (\n          <Loading app={this} />\n        ) }\n      </div>\n    );\n  }\n\n  componentDidMount() {\n    const assets = [...this.state.assets];\n\n    return Promise.all(assets.map(asset => {\n      return new Promise((resolve, reject) => {\n\n        const url = `${config.assetBasePath}/${asset.name}.png?v4`;\n\n        const options = {\n          method: 'GET',\n          mode: 'cors',\n          cache: 'force-cache'\n        };\n\n        fetch(url, options)\n        .then((response) => response.blob() )\n        .then(blob => {\n          asset.src = URL.createObjectURL(blob);\n\n          asset.imgEl = <img\n            src={asset.src}\n            alt={asset.prettyName}\n            className='asset'\n            draggable={false}\n          />;\n\n          asset.img = document.createElement('img');\n          asset.img.onload = (e) => {\n            this.setState({ assetsLoaded: this.state.assetsLoaded + 1 });\n            resolve();\n          };\n          asset.img.src = asset.src;\n\n        }).catch(err => {\n          console.error(`${url} failed to load`, err);\n          reject();\n        });\n\n      });\n    })).then(() => {\n      this.setState({\n        assets,\n        allAssetsLoaded: true,\n      });\n      this.randomize();\n    });\n  }\n\n  findAsset = (name) => {\n    return this.state.assets.find(asset => asset.name === name);\n  }\n\n  addCustomAsset = (name, src) => {\n    name = name.substr(0, name.lastIndexOf('.')).replace(/_|-/g, ' ');\n    const prettyName = toTitleCase(name);\n\n    const imgEl = <img\n      src={src}\n      alt={prettyName}\n      className='asset'\n      draggable={false}\n    />;\n\n    const img = document.createElement('img');\n\n    const asset = {\n      name,\n      prettyName,\n      category: 'custom',\n      prettyCategory: 'Custom',\n      src,\n      imgEl,\n      img,\n    };\n\n    img.onload = (e) => { \n      const assets = [...this.state.assets];\n      assets.unshift(asset);\n\n      this.setState({ assets }, () => {\n        this.addLayer(asset.name);\n      });\n    }\n\n    img.src = src;\n  }\n\n  randomize = () => {\n    function pick(category) {\n      const picks = assets.filter(asset => asset.category === category);\n      return picks[Math.floor(Math.random() * picks.length)].name;\n    }\n\n    this.clear().then(() => {\n      this.addLayer(pick('mouth'));\n    \n      const eye = pick('eye')\n      this.addLayer(eye);\n    \n      if (Math.random() > 0.5) this.addLayer(eye);\n      else this.addLayer(pick('eye'));\n    \n      if (Math.random() > 0.5) this.addLayer(pick('acc'), Math.random() > 0.5);\n    });\n  }\n\n  clear = (callback) => {\n    const base = this.findBaseLayer();\n    const baseAssetName = base ? base.asset.name : 'face_base';\n\n    return new Promise((resolve, reject) => {\n      this.setState(\n        { layers: [] }, \n        () => { \n          if (baseAssetName) this.addLayer(baseAssetName);\n          resolve();\n        }\n      );\n    })\n  }\n\n  save = () => {\n    const canvas = this.Canvas.current.mainCanvas.current;\n    const title = this.Title.current.getTitle();\n    const button = this.SaveButton.current;\n\n    button.href = canvas.toDataURL();\n    button.download = title.replace(/ /g, '_') + '.png';\n\n    if (window.gtag) {\n      window.gtag('event', 'download', { \n        event_category: 'emojibuilder', \n        event_label: title,\n      });\n    }\n  }\n\n  addLayer = (assetName, flipped) => {\n    let layers = [...this.state.layers];\n\n    const layer = {\n      asset: this.findAsset(assetName),\n      flipped,\n      transform: {\n        translateX: 0,\n        translateY: 0,\n        scale: 1,\n        rotate: 0,\n      },\n      showTransforms: false,\n    };\n  \n    // Flip any second 'eye' layers or duplicates\n    if (flipped === undefined) {\n      const eyes = layers.filter(layer => layer.asset.category === 'eye');\n      const dups = layers.filter(layer => layer.asset.name === assetName);\n  \n      layer.flipped = (\n        (eyes.length === 1 && !eyes[0].flipped) || \n        (dups.length === 1 && !dups[0].flipped)\n      );\n    }\n  \n    // Only allow one 'base' layer\n    if (layer.asset.base) {\n      layers = layers.filter(layer => !layer.asset.base);\n    }\n  \n    // Add layer at a specific position\n    if (layer.asset.position !== undefined && layers.length > 0) {\n      const insertIndex = Math.min(layer.asset.position, layers.length - 1);\n      layers.splice(insertIndex, 0, layer);\n    }\n    // Or just at the end\n    else {\n      layers.push(layer);\n    }\n  \n    this.setState({ layers });\n  }\n  \n  removeLayer = (layer) => {\n    let layers = [...this.state.layers];\n    const index = layers.indexOf(layer);\n    layers.splice(index, 1);\n  \n    this.setState({ layers });\n  }\n  \n  flipLayer = (layer) => {\n    let layers = [...this.state.layers];\n    const index = layers.indexOf(layer);\n    layers[index].flipped = !layers[index].flipped;\n\n    this.setState({ layers });\n  }\n  \n  toggleLayerTransforms = (layer) => {\n    let layers = [...this.state.layers];\n    const index = layers.indexOf(layer);\n    layers[index].showTransforms = !layers[index].showTransforms;\n\n    this.setState({ layers });\n  }\n\n  findBaseLayer = () => {\n    return this.state.layers.find(layer => layer.asset.base);\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}